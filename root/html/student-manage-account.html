<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel='stylesheet'>
  <link href='https://fonts.googleapis.com/css?family=Lora' rel='stylesheet'>
  <script src="https://kit.fontawesome.com/a39233b32c.js" crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <title>Manage Account</title>
  <link href="../css/manage-account.css" rel="stylesheet">
</head>
<body>

<!-- Header Sidebar -->
<div id="header-sidebar"></div>

<div class="content-section">
  <div class="content-container">
    <!-- sidebar -->
    <div id="settings-sidebar" class ="d-flex flex-column">
      <h4 class="mb-4 mt-4"><strong>Manage Account</strong></h4>
      <!-- sidebar buttons -->
      <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
        <a class="nav-link" id="change-pass"
           data-bs-toggle="pill" href="#change-pass-tab" role="tab"
           aria-controls="change-pass" aria-selected="true">Change Password</a>
        <a class="nav-link" id="priv-settings"
           data-bs-toggle="pill" href="#priv-settings-tab" role="tab"
           aria-controls="priv-settings" aria-selected="false">Privacy Settings</a>

        <a class="nav-link" id="notif-settings"
           data-bs-toggle="pill" href="#notif-settings-tab" role="tab"
           aria-controls="notif-settings" aria-selected="false">Notification Settings</a>

        <a class="nav-link" id="delete-acc"
           data-bs-toggle="pill" href="#delete-acc-tab" role="tab"
           aria-controls="delete-acc" aria-selected="false">Delete Account</a>
      </div>
    </div>

    <div class="tab-content" id="v-pills-tabContent">

      <!-- change password tab -->
      <div class="tab-pane fade" id="change-pass-tab" role="tabpanel" aria-labelledby="change-pass">
        <div class="content">
          <h5 class="mb-5 mt-4"><strong>Change Password</strong></h5>
          <form id="pass-info" novalidate>
            <div class="form-group row">

              <label for="curr-password" class="col-sm-2 col-form-label">Current Password</label>
              <div class="col-sm-10 input-spacing">
                <input type="password" class="form-control" id="curr-password" placeholder="Current Password" required>
                <div class="invalid-feedback">Current password is required.</div>
              </div>

              <label for="new-password" class="col-sm-2 col-form-label">New Password</label>
              <div class="col-sm-10 input-spacing">
                <input type="password" class="form-control" id="new-password" placeholder="New Password" required>
                <div class="invalid-feedback">Password must be at least 8 characters.</div>
              </div>

              <label for="confirm-password" class="col-sm-2 col-form-label">Confirm New Password</label>
              <div class="col-sm-10 input-spacing">
                <input type="password" class="form-control" id="confirm-password" placeholder="Confirm Password" required>
                <div class="invalid-feedback">Passwords do not match.</div>
              </div>
            </div>

            <div class="d-flex justify-content-center mt-4">
              <button type="button" class="btn btn-primary" id="submit-pass" data-bs-toggle="modal"
                      data-bs-target="#confirm-change" disabled>Change Password</button>

              <div class="modal fade" id="confirm-change" tabindex="-1" role="dialog" aria-labelledby="confirm-change-label" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="confirm-change-label">Confirm Change</h5>
                    </div>
                    <div class="modal-body">
                      Are you sure you want to change your password?
                    </div>
                    <div class="modal-footer">
                      <button type="submit" class="btn btn-primary" id="confirm-btn">Yes</button>
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="modal fade" id="change-success" tabindex="-1" aria-labelledby="change-success-label" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="change-success-label">Success</h5>
                    </div>
                    <div class="modal-body text-center">
                      Your password has been changed successfully!
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-success" data-bs-dismiss="modal">OK</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </form>
        </div>

      </div>

      <!-- privacy settings tab -->
      <div class="tab-pane fade" id="priv-settings-tab" role="tabpanel" aria-labelledby="priv-settings">
        <div class="content">
          <h5 class="mb-5 mt-4"><strong>Privacy Settings</strong></h5>
          <!-- account visibility -->
          <div class="pb-4" style="border-bottom: 2px solid #f3f3f3;">
            <label class="form-label mb-4"><b>Account Visibility</b></label>

            <div class="form-check">
              <input type="radio" class="form-check-input" name="acc-visible" id="public" value="public" checked>
              <label class="form-check-label" for="public">Public</label>
              <small class="text-muted d-block">Anyone can see your account.</small>
            </div>

            <div class="form-check">
              <input type="radio" class="form-check-input" name="acc-visible" id="private" value="private">
              <label class="form-check-label" for="private">Private</label>
              <small class="text-muted d-block">Only lab technicians can see your account.</small>
              <!-- im not sure if there should be an option to completely make user anonymous lol -->
            </div>
          </div>

          <!-- activity sharing -->
          <div class="pt-4 pb-4">
            <label class="form-label mb-4"><b>Activity Sharing</b></label>

            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="show-stats">
              <label class="form-check-label" for="show-stats">Show my statistics to other users</label>
            </div>

            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="show-reserves">
              <label class="form-check-label" for="show-reserves">Show my reservations to other users</label>
            </div>

            <div class="mb-4 mt-2 mx-4">
              <div class="form-check">
                <input type="checkbox" class="form-check-input reserve-checkbox" id="show-booked" disabled>
                <label class="form-check-label" for="show-booked">Allow others to see my booked reservations</label>
              </div>

              <div class="form-check">
                <input type="checkbox" class="form-check-input reserve-checkbox" id="show-ongoing" disabled>
                <label class="form-check-label" for="show-ongoing">Allow others to see my ongoing reservations</label>
              </div>

              <div class="form-check">
                <input type="checkbox" class="form-check-input reserve-checkbox" id="show-previous" disabled>
                <label class="form-check-label" for="show-previous">Allow others to see my previous reservations</label>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-center mt-4">
            <button type="button" class="btn btn-primary" id="change-priv" data-bs-toggle="modal" data-bs-target="#change-setting-success">Save Changes</button>
          </div>
        </div>
      </div>

      <div class="modal fade" id="change-setting-success" tabindex="-1" aria-labelledby="setting-success-label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="setting-success-label">Success!</h5>
            </div>
            <div class="modal-body text-center">
              Your settings has been changed successfully!
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-success" data-bs-dismiss="modal">OK</button>
            </div>
          </div>
        </div>
      </div>

      <!-- notification settings tab -->
      <div class="tab-pane fade" id="notif-settings-tab" role="tabpanel" aria-labelledby="notif-settings">
        <div class="content">
          <h5 class="mb-5 mt-4"><strong>Notification Settings</strong></h5>
          <form id="notif-settings-form">
            <!-- enable/disable notifs -->
            <div class="form-check form-switch pb4" style="border-bottom: 2px solid #f3f3f3;">
              <input class="form-check-input" type="checkbox" id="enable-notif" checked>
              <label class="form-check-label mb-4" for="enable-notif">Enable Notifications</label>
            </div>

            <!-- notif preferences -->
            <div class="pt-4 pb-4" style="border-bottom: 2px solid #f3f3f3;">
              <label class="form-label mb-4"><b>Notification Preferences</b></label>
              <div class="form-check form-switch">
                <input class="form-check-input notif-checkbox" type="checkbox" id="notif-reminders">
                <label class="form-check-label" for="email-notif">Get reminders for my upcoming reservations</label>
              </div>

              <div class="form-check form-switch">
                <input class="form-check-input notif-checkbox" type="checkbox" id="notif-updates">
                <label class="form-check-label" for="sms-notif">Receive lab updates and announcements</label>
              </div>

            </div>

            <!-- notif methods -->
            <div class="pt-4 pb-4" style="border-bottom: 2px solid #f3f3f3;">
              <label class="form-label mb-4"><b>Notification Methods</b></label>

              <div class="form-check form-switch">
                <input class="form-check-input notif-checkbox" type="checkbox" id="email-notif">
                <label class="form-check-label" for="email-notif">Receive notifications via Email</label>
              </div>

              <div class="form-check form-switch">
                <input class="form-check-input notif-checkbox" type="checkbox" id="sms-notif">
                <label class="form-check-label" for="sms-notif">Receive notifications via SMS</label>
              </div>
            </div>

            <div class="d-flex justify-content-center mt-4">
              <button type="button" class="btn btn-primary" id="change-notif"
                      data-bs-toggle="modal" data-bs-target="#change-setting-success">Save Changes</button>
            </div>
          </form>

        </div>
      </div>

      <!-- delete account tab -->
      <div class="tab-pane fade" id="delete-acc-tab" role="tabpanel" aria-labelledby="delete-acc">
        <div class="content">
          <h5 class="mb-5 mt-4"><strong>Delete Account</strong></h5>
            <p class="text-danger">
              <i class="fa-solid fa-triangle-exclamation" style="color: red;"></i>
              <b>Warning: This action is irreversible. All your data, including your profile, reservations, and settings will be lost and can never be retrieved.</b>
            </p><br/>
            <form id="delete-acc-details">
              <div class="mb-3">
                <label class="form-label"><b>Enter your account details to confirm:</b></label>
                <div class="col-sm-10 input-spacing">
                  <input type="text" class="form-control" id="delete-acc-email" placeholder="Email" required>
                </div>
                <div class="col-sm-10 input-spacing">
                  <input type="password" class="form-control" id="delete-acc-pass" placeholder="Password" required>
                </div>
                <div class="form-check col-sm-10 input-spacing">
                  <input class="form-check-input" type="checkbox" value="" id="delete-acc-check">
                  <label class="form-check-label" for="delete-acc-check">
                    I understand that deleting my account is irreversible.
                  </label>
                </div>
              </div>

              <div class="d-flex justify-content-center mt-4">
                <button type="button" class="btn btn-primary" id="submit-delete" data-bs-toggle="modal"
                        data-bs-target="#confirm-delete" disabled>Delete My Account</button>

                <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="confirm-delete-label" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="confirm-delete-label">Confirm Account Deletion</h5>
                      </div>
                      <div class="modal-body">
                        Are you sure you want to delete your account?
                      </div>
                      <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" id="delete-yes">Yes</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

    </div>
  </div>

</div>

<div id="footer"></div>


<script>
  // Function to load a component
  function loadComponent(componentId, filePath, callback) {
    fetch(filePath)
            .then(response => response.text())
            .then(data => {
              $("#" + componentId).html(data);
              if (typeof callback === "function") {
                callback();
              }
            })
            .catch(error => console.error('Error loading component:', error));
  }
  // Load header and sidebar
  loadComponent('header-sidebar', 'student-header-fix.html');
  loadComponent('footer', 'fixed-footer.html');

  //This is to change tabs in settings
  $(document).ready(function () {
    $('#v-pills-tab a').on('click', function (e) {
      e.preventDefault();
      //switches tabs by deactivating & activating tabs
      $('#v-pills-tab .nav-link').removeClass('active');
      $(this).addClass('active');
      new bootstrap.Tab(this).show();

      //to reset the forms when switching tabs
      $('#v-pills-tabContent form').each(function () {
        this.reset();
        $(this).removeClass('was-validated');
      });
      $('#v-pills-tabContent form .form-control').removeClass('is-invalid is-valid');
    });

    const pass_form = $('#pass-info');
    const newPass = $('#new-password');
    const confirmPass = $('#confirm-password');
    const submitBtn = $('#submit-pass');
    const confirmModalSubmit = $('#confirm-btn');

    const deleteForm = $('#delete-acc-details');
    const submit = $('#submit-delete');
    const checkbox = $('#delete-acc-check');

    //button availability for Delete Account
    function checkForm() {
      let isFilled = true;
      deleteForm.find('[required]').each(function () {
        if ($(this).val().trim() === "") {
          isFilled = false;
        }
      });

      submit.prop('disabled', !(isFilled && checkbox.prop('checked')));
    }
    checkForm();

    deleteForm.on('input change', checkForm);

    //validate password input
    function validatePasswords() {
      //new password must be at least 8 chars
      if (newPass.val().length >= 8) {
        newPass.removeClass("is-invalid").addClass("is-valid");
      } else {
        newPass.removeClass("is-valid").addClass("is-invalid");
      }

      //new pass and confirm pass must be the same
      if (confirmPass.val() === newPass.val() && confirmPass.val().length >= 6) {
        confirmPass.removeClass("is-invalid").addClass("is-valid");
        submitBtn.prop("disabled", false);
      } else {
        confirmPass.removeClass("is-valid").addClass("is-invalid");
        submitBtn.prop("disabled", true);
      }
    }

    newPass.on("input", validatePasswords);
    confirmPass.on("input", validatePasswords);

    //change password modal from confirmation to success
    confirmModalSubmit.on("click", function () {
      var confirmModal = bootstrap.Modal.getInstance($('#confirm-change')[0]);
      confirmModal.hide();

      setTimeout(() => {
        var successModal = new bootstrap.Modal($('#change-success')[0]);
        successModal.show();

        pass_form[0].reset();

        newPass.removeClass("is-valid is-invalid");
        confirmPass.removeClass("is-valid is-invalid");
        submitBtn.prop("disabled", true);
      }, 500);
    });

    //this is to show "password changed successfully" modal
    pass_form.on("submit", function (event) {
      event.preventDefault();
      return false;
    });

    const deleteYes = $('#delete-yes');

    //to not refresh page when submitting "yes" in account deletion
    deleteForm.on("submit", function (event) {
      event.preventDefault();
      return false;
    });

    //redirects to home page upon deleting account
    deleteYes.on("click", function () {
      alert("Account deleted successfully.");
      window.location.href = "signup-homepage.html";
    });

    //enable/disable checkboxes in privacy settings based on "show reservations" option
    $("#show-reserves").on("change", function () {
      const checkboxes = $(".reserve-checkbox");

      checkboxes.each(function () {
        if (!$('#show-reserves').prop("checked")) {
          $(this).prop("checked", false);
        }
        $(this).prop("disabled", !$('#show-reserves').prop("checked"));
      });
    });

    //enable/disable checkboxes in notif settings based on "enable notifs" option
    $("#enable-notif").on("change", function () {
      const checkboxes = $(".notif-checkbox");

      checkboxes.each(function () {
        if (!$('#enable-notif').prop("checked")) {
          $(this).prop("checked", false);
        }
        $(this).prop("disabled", !$('#enable-notif').prop("checked"));
      });
    });
  });

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>
